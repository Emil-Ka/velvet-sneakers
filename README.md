# Магазин самых бархатных тяг в мире

## Как запустить проект?

1. `npm ci` - установка всех зависимостей
2. `npm ssr:build` - сборка проекта
3. `npm ssr:run` - запсук проекта

## Введение в самописный SSR фреймворк

### Принцип работы
1. Вы заходите на какую-либо страницу
2. Сервер регистрирует, на какую именно страницу вы зашли
3. Если в настройках роутинга для этой страницы 
задана функция для подгрузки 
данных, то сервер загрузит эти данные
4. Подгруженные данные вставляются в вёрстку на стороне сервера
5. Готовая вёрстка с уже вставленными данными возвращается клиенту,
также сервер посылает клиенту данные, которые он подгрузил, чтобы
синхронизировать состояние стейт-менеджера на клиенте
6. На стороне клиента происходит гидратация, а также предварительно
установленные данные попадают в стейт-менеджер на стороне клиента,
чтобы состояние на стороне сервера и на стороне клиента 
было одинаковым

### Хранилище данных

В качестве стейт менеджера мы используем Redux Toolkit.
Вся настройка ведётся в папке [src/store](./src/store)

Если вы хотите предварительно загрузить какие-либо данные
на стороне сервера, чтобы потом отобразить их на странице,
то вам для начала нужно создать слайс в 
Redux, у которого обязательно должно быть свойство `data`,
именно туда будут попадать предварительно загруженные данные.

Пример слайса `beforAfterPage`
```js
const initialState = {
    data: [],
};

export const { actions, reducer } = createSlice({
    initialState,
    name: 'beforAfterPage',
    reducers: {},
});
```

### Роутинг

Весь роутинг приложения располагается в файле [src/pages/routes.tsx](./src/pages/routes.tsx).
Роутинг устроен таким образом, что вы можете задать функцию, 
которая предварительно подгрузит данные на стороне сервера.
```
path - путь до страницы
component - компонент, который нужно отрисовать
loadData - функция для подгрузки данных для компонента (должна возвращать Promise)
sliceName - названия redux слайса, куда попадут предварительно загруженные данные
```

В качестве пример возьмём страницу До / После. 
В настройке роутинга указываем функцию, которая подгрузит 
данные с продукатми, а также указываем созданный в Redux слайс, 
куда потом попадут эти продукты.
```js
const routes = [
    {
        path: '/before-after',
        component: <BeforeAfter />,
        loadData: () => {
          return backendApi.get('/product');
        },
        sliceName: 'beforeAfterPage',
      },
]
```

В самом компоненте с помощью функции `useSelector` получаем 
наши продукты из стора и отрисовываем их.

```js
const BeforeAfter = () => {
    const products = useSelector(state => state.beforeAfterPage.data);

    return (
        <Page>
            <Helmet>
                <title>До / После</title>
                <meta
                    name="description"
                    content="Взгляните, как наши средства помогают очистить кроссовки"
                />
            </Helmet>
            <Container className={styles.container}>
                <ul className={styles.products}>
                    {products.map(({ id, image, title }) => (
                        <li key={id}>
                            <img src={image} alt={title} />
                        </li>
                    ))}
                </ul>
            </Container>
        </Page>
    );
};
```

Также стоит сказать, что теперь нельзя использовать компонент
`<Link />` из `react-router-dom`. Вместо него для ссылок используйте
компонент `<Link />` из [shared/components](./src/shared/components/link)

### SEO

Благодаря SSR теперь браузер получает предварительно отрендеренную вёрстку,
а не просто `<div id="root"></div>`. Но метаинформация, заголовки
и прочее также остаются одинаковыми для всех страниц. Чтобы избежать
этого, вы можете с помощью компонента `<Helmet />` их заранее
установленного `react-helmet` задать для каждой страницы
свою метаинформацию, заголовки и т.д.

Рассмотри на примере главной страницы. Оборачиваем в `<Helmet />` 
всю нужную информацию и всё. Теперь наш SSR сервер 
возьмёт эту метаинформацию и заранее вставит на страницу.
```js
const Home = () => {
    return (
        <Page>
            <Helmet>
                <title>Главная страница</title>
                <meta
                    name="description"
                    content="Pure Sneakers - это интернет-магазин, в котором вы можете
                   заказать средства для очистки ваших кроссовок"
                />
            </Helmet>
            <Promo />
            <BeforeAfter />
            <Advantages />
            <ShopPreview />
            <BeforeAfterPreview />
            <Subscription />
            <AboutUs />
            <Map />
        </Page>
    );
};
```